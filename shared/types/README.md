# Shared Types

This directory contains TypeScript types shared between client and server code.

## Contents

### `graphql.ts` (Auto-Generated)
**DO NOT EDIT THIS FILE MANUALLY**

This file is automatically generated from the GraphQL schema using GraphQL Code Generator.

- **Source**: `server/graphql/schema/typeDefs.ts`
- **Generator Config**: `codegen.yml`
- **Generated Types**:
  - GraphQL schema types (User, Profile, etc.)
  - Input types (CreateUserInput, UpdateProfileInput, etc.)
  - Resolver types for server-side use
  - Query/Mutation operation types (when client queries are added)

### Regenerating Types

When you modify the GraphQL schema:

```bash
# One-time generation
npm run codegen

# Watch mode (regenerates on schema changes)
npm run codegen:watch

# Using convenience script
./scripts/codegen.sh
```

## Usage Examples

### Client-Side (Apollo Client)

```typescript
import { useQuery, useMutation } from '@apollo/client';
import { GQL_User, GQL_CreateUserInput } from '@shared/types/graphql';
import { gql } from '@apollo/client';

// Define query
const GET_USER = gql`
  query GetUser($id: ID!) {
    getUser(id: $id) {
      id
      email
      username
      profile {
        firstName
        surname
      }
    }
  }
`;

// Use with generated types
const { data } = useQuery<{ getUser: GQL_User }>(GET_USER, {
  variables: { id: userId }
});

// TypeScript knows the exact shape!
if (data?.getUser) {
  const email = data.getUser.email;  // ✅ string
  const name = data.getUser.profile?.firstName;  // ✅ string | null | undefined
}
```

### Server-Side (Resolvers)

```typescript
import { GQL_User, GQL_Resolvers } from '@shared/types/graphql';

export const resolvers: GQL_Resolvers = {
  Query: {
    getUser: async (_, { id }, context): Promise<GQL_User> => {
      // TypeScript enforces correct return type
      const user = await context.db.user.findById(id);

      return {
        id: user.id,
        email: user.email,
        username: user.username,
        createdAt: user.created_at.toISOString(),
        // TypeScript error if you miss required fields!
      };
    }
  }
};
```

## Type Naming Convention

All generated GraphQL types are prefixed with `GQL_` to distinguish them from other types:

- `GQL_User` - User type from schema
- `GQL_CreateUserInput` - Input type for creating users
- `GQL_Resolvers` - Type-safe resolver signature
- `GQL_QueryResolvers` - Query resolver types
- `GQL_MutationResolvers` - Mutation resolver types

## Adding Custom Shared Types

For non-GraphQL shared types, create separate files in this directory:

```
shared/types/
  ├── README.md          # This file
  ├── graphql.ts         # Auto-generated (DO NOT EDIT)
  ├── user.ts            # Custom user-related types
  ├── validation.ts      # Shared validation types
  └── common.ts          # Common utility types
```

## Schema Changes Workflow

1. **Update Schema**: Edit `server/graphql/schema/typeDefs.ts`
2. **Regenerate Types**: Run `npm run codegen`
3. **Fix Type Errors**: TypeScript will show errors in client/server code
4. **Update Code**: Fix all type errors before committing
5. **Commit Together**: Commit schema changes + generated types + code updates together

This ensures client and server always stay in sync!
